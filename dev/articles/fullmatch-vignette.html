<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Matching in R using the optmatch package • optmatch</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Matching in R using the optmatch package">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">optmatch</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.10.8.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/fullmatch-vignette.html">Matching in R using the optmatch package</a></li>
    <li><a class="dropdown-item" href="../articles/matching-from-foreign-software.html">Using Optmatch on data in SAS, Stata, etc</a></li>
    <li><a class="dropdown-item" href="../articles/matching-within-subgroups.html">Combining Matches Within Subgroups</a></li>
    <li><a class="dropdown-item" href="../articles/MCFSolutions.html">Classes and methods for min-cost flow solutions</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/markmfredrickson/optmatch/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Matching in R using the optmatch package</h1>
                        <h4 data-toc-skip class="author">Ben B. Hansen,
Mark Fredrickson, Josh Errickson, and Josh Buckner</h4>
            
            <h4 data-toc-skip class="date">2024-09-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/markmfredrickson/optmatch/blob/master/vignettes/fullmatch-vignette.Rmd" class="external-link"><code>vignettes/fullmatch-vignette.Rmd</code></a></small>
      <div class="d-none name"><code>fullmatch-vignette.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="the-r-environment">The <em>R</em> Environment<a class="anchor" aria-label="anchor" href="#the-r-environment"></a>
</h2>
<p>All the software used in this worksheet is freely available. The
<em>R</em> statistical package is installed for you in the lab, but you
may download and install <em>R</em> for Windows, Mac, and Linux systems
from: <a href="https://www.r-project.org" class="external-link uri">https://www.r-project.org</a>.</p>
<p>The following document walks through a common propensity score
matching work-flow in <em>R</em>. Example <em>R</em> code will appear
with a <code>&gt;</code> indicating the command prompt. You may type
this code yourself — each line is a command to <em>R</em>. Output will
follow prefaced by <code>##</code>. (In <em>R</em>, <code>#</code>
represents a comment; any command preceded by any number of
<code>#</code>’s will not be executed.) For example:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="do">## [1] 4</span></span></code></pre></div>
<p>(Note that when entering the code yourself, do not include the
<code>&gt;</code> in your command. Also, for longer lines of code in
this document, the text may wrap onto a second line, with the second
line preceded by a <code>+</code> sign. When entering the code yourself,
you do not have to wrap the lines, and do not include the
<code>+</code>.)</p>
<p><em>R</em> stores data in named variables using the arrow
operator:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="sc">&gt;</span> my.variable <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="sc">&gt;</span> my.variable <span class="sc">*</span> <span class="dv">3</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="do">## [1] 12</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="section level3">
<h3 id="outfitting-your-r-with-the-proper-add-ons">Outfitting your <em>R</em> with the proper add-ons<a class="anchor" aria-label="anchor" href="#outfitting-your-r-with-the-proper-add-ons"></a>
</h3>
<p><em>R</em> add-on packages are available to install directly from
<em>R</em>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">install.packages</span>(<span class="st">"optmatch"</span>)</span></code></pre></div>
<p>Thi command will ask you to select a CRAN server. Any server will do.
You may also be asked whether you’d like to set up a “personal library
to install packages into”; if so, answer yes. (The default personal
library location that <em>R</em> will suggest should be OK.) You’ll only
need to run these commands the first time you want to use
<strong>optmatch</strong> on a particular computer, or when you install
a new version of <em>R</em>.</p>
</div>
<div class="section level3">
<h3 id="setting-up-the-r-environment-for-matching">Setting up the <em>R</em> environment for matching<a class="anchor" aria-label="anchor" href="#setting-up-the-r-environment-for-matching"></a>
</h3>
<p>Attach extension packages that we’ll be using for matching and
associated diagnostics:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(optmatch)</span></code></pre></div>
<p>You’ll do this each time you start a new <em>R</em> session and want
to run matching commands.</p>
<p>To load the nuclear plants data, enter</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">data</span>(nuclearplants)</span></code></pre></div>
<p>To see the first six rows:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">head</span>(nuclearplants)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="do">##     cost  date t1 t2  cap pr ne ct bw cum.n pt</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="do">## H 460.05 68.58 14 46  687  0  1  0  0    14  0</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="do">## I 452.99 67.33 10 73 1065  0  0  1  0     1  0</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="do">## A 443.22 67.33 10 85 1065  1  0  1  0     1  0</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="do">## J 652.32 68.00 11 67 1065  0  1  1  0    12  0</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="do">## B 642.23 68.00 11 78 1065  1  1  1  0    12  0</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="do">## K 345.39 67.92 13 51  514  0  1  1  0     3  0</span></span></code></pre></div>
<p>For more on the variables here, enter</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">help</span>(<span class="st">"nuclearplants"</span>)</span></code></pre></div>
<p>You can directly access a variable within this data frame as follows.
(Try typing in the commands to see what they do.)</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="sc">&gt;</span> nuclearplants<span class="sc">$</span>pt</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">table</span>(nuclearplants<span class="sc">$</span>pt)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">with</span>(nuclearplants, <span class="fu">table</span>(pt))</span></code></pre></div>
<p>The variable you will have just viewed and tabulated,
<code>pt</code>, is a dummy for whether the plant was built with
“partial turnkey guarantees.” These plants were not comparable to the
others in terms of construction costs. Let’s exclude them for the time
being, for simplicity. To do this we’ll create a data table (in
<em>R</em> jargon, a “data frame”) of just those observations for which
<code>pt</code> is 0:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="sc">&gt;</span> nuke.nopt <span class="ot">&lt;-</span> <span class="fu">subset</span>(nuclearplants, pt <span class="sc">==</span> <span class="dv">0</span>)</span></code></pre></div>
<p>To inspect its first six or last six entries, do</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">head</span>(nuke.nopt)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">tail</span>(nuke.nopt)</span></code></pre></div>
<p>To view this as presenting a matching problem, we’ll think of plants
built on the site of a previously existing plant (<code>pr == 1</code>)
as the treatment group and plants on new sites (<code>pr == 0</code>) as
comparisons.</p>
</div>
</div>
<div class="section level2">
<h2 id="optimal-pair-matching-and-1k-matching">Optimal pair matching and 1:k matching<a class="anchor" aria-label="anchor" href="#optimal-pair-matching-and-1k-matching"></a>
</h2>
<div class="section level3">
<h3 id="pair-matching">Pair matching<a class="anchor" aria-label="anchor" href="#pair-matching"></a>
</h3>
<p>To check the number of treated and control plants:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">table</span>(nuke.nopt<span class="sc">$</span>pr)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="do">##  0  1 </span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="do">## 19  7</span></span></code></pre></div>
<p>To get the pair match minimizing the mean paired distance on
<code>cap</code>, among all collections of 7 non-overlapping pairs,
do</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">pairmatch</span>(pr <span class="sc">~</span> cap, <span class="at">data =</span> nuke.nopt)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="do">##    H    I    A    J    B    K    L    M    C    N    O    P    Q    R    S    T </span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="do">## &lt;NA&gt;  1.1  1.1  1.2  1.2 &lt;NA&gt;  1.7 &lt;NA&gt;  1.3 &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;  1.4  1.5  1.3 &lt;NA&gt; </span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="do">##    U    D    V    E    W    F    X    G    Y    Z </span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="do">##  1.6  1.4 &lt;NA&gt;  1.5 &lt;NA&gt;  1.6 &lt;NA&gt;  1.7 &lt;NA&gt; &lt;NA&gt;</span></span></code></pre></div>
<p>For a more readable report of who gets matched to whom, type</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">print</span>(<span class="fu">pairmatch</span>(pr <span class="sc">~</span> cap, <span class="at">data =</span> nuke.nopt), <span class="at">grouped =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="do">##  Group Members</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="do">##    1.1    I, A</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="do">##    1.2    J, B</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="do">##    1.3    C, S</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="do">##    1.4    Q, D</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="do">##    1.5    R, E</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="do">##    1.6    U, F</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="do">##    1.7    L, G</span></span></code></pre></div>
<p>For matching on both <code>date</code> and <code>cap</code>, you’d
type <code>pairmatch(pr ~ cap + date, ...)</code> instead of
<code>pairmatch(pr ~ cap, ...)</code>. We’ll talk later about how this
combines discrepancies on the two variables. For now, note the form of
the output this command generates: a variable of the same length as the
variables making up <code>nuke.nopt</code>, assigning a distinct name to
each matched set. To fix your intuition, you might try connecting up
below the units that <code><a href="../reference/pairmatch.html">pairmatch()</a></code> has placed in the same
matched sets.</p>
<table style="width:72%;" class="table">
<caption>New-site (left columns) versus existing-site (right columns)
plants. “date” is <code>date-65</code>; “capacity” is
<code>cap-400</code>.</caption>
<colgroup>
<col width="11%">
<col width="9%">
<col width="15%">
<col width="11%">
<col width="9%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="center">Plant</th>
<th align="center">Date</th>
<th align="center">Capacity</th>
<th align="center">Plant</th>
<th align="center">Date</th>
<th align="center">Capacity</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">A</td>
<td align="center">2.3</td>
<td align="center">660</td>
<td align="center">H</td>
<td align="center">3.6</td>
<td align="center">290</td>
</tr>
<tr class="even">
<td align="center">B</td>
<td align="center">3.0</td>
<td align="center">660</td>
<td align="center">I</td>
<td align="center">2.3</td>
<td align="center">660</td>
</tr>
<tr class="odd">
<td align="center">C</td>
<td align="center">3.4</td>
<td align="center">420</td>
<td align="center">J</td>
<td align="center">3</td>
<td align="center">660</td>
</tr>
<tr class="even">
<td align="center">D</td>
<td align="center">3.4</td>
<td align="center">130</td>
<td align="center">K</td>
<td align="center">2.9</td>
<td align="center">110</td>
</tr>
<tr class="odd">
<td align="center">E</td>
<td align="center">3.9</td>
<td align="center">650</td>
<td align="center">L</td>
<td align="center">3.2</td>
<td align="center">420</td>
</tr>
<tr class="even">
<td align="center">F</td>
<td align="center">5.9</td>
<td align="center">430</td>
<td align="center">M</td>
<td align="center">3.4</td>
<td align="center">60</td>
</tr>
<tr class="odd">
<td align="center">G</td>
<td align="center">5.1</td>
<td align="center">420</td>
<td align="center">N</td>
<td align="center">3.3</td>
<td align="center">390</td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">O</td>
<td align="center">3.6</td>
<td align="center">160</td>
</tr>
<tr class="odd">
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">P</td>
<td align="center">3.8</td>
<td align="center">390</td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">Q</td>
<td align="center">3.4</td>
<td align="center">130</td>
</tr>
<tr class="odd">
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">R</td>
<td align="center">3.9</td>
<td align="center">650</td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">S</td>
<td align="center">3.9</td>
<td align="center">450</td>
</tr>
<tr class="odd">
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">T</td>
<td align="center">3.4</td>
<td align="center">380</td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">U</td>
<td align="center">4.5</td>
<td align="center">440</td>
</tr>
<tr class="odd">
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">V</td>
<td align="center">4.2</td>
<td align="center">690</td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">W</td>
<td align="center">3.8</td>
<td align="center">510</td>
</tr>
<tr class="odd">
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">X</td>
<td align="center">4.7</td>
<td align="center">390</td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">Y</td>
<td align="center">5.4</td>
<td align="center">140</td>
</tr>
<tr class="odd">
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">Z</td>
<td align="center">6.1</td>
<td align="center">730</td>
</tr>
</tbody>
</table>
<p>For basic summary information about this match, try</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(<span class="fu">pairmatch</span>(pr <span class="sc">~</span> cap, <span class="at">data =</span> nuke.nopt))</span></code></pre></div>
<p>If you’ve already typed in the <code>pairmatch(...)</code> part, you
can use the up-arrow, Home and End keys to avoid having to re-type.
Alternatively, to assign the name “<code>pm</code>” to the matching
result, do</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="sc">&gt;</span> pm <span class="ot">&lt;-</span> <span class="fu">pairmatch</span>(pr <span class="sc">~</span> cap, <span class="at">data =</span> nuke.nopt)</span></code></pre></div>
<p>Now, you can just type <code>print(pm, grouped = TRUE)</code> or
<code>summary(pm)</code>.</p>
<p>The following would give a basic matched analysis of the effect of
new or existing site on construction costs is given with the help of
<em>R</em>’s linear modeling function. In effect, the existing site
effect is estimated as one “way” in a two-way , the other “way” being
the factor variable that represents the matching result,
i.e. <code>pm</code>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(<span class="fu">lm</span>(cost <span class="sc">~</span> pr <span class="sc">+</span> pm, <span class="at">data =</span> nuke.nopt))</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="matching-with-multiple-controls">Matching with multiple controls<a class="anchor" aria-label="anchor" href="#matching-with-multiple-controls"></a>
</h3>
<p>There are other types of matches you might want to try. Here’s how to
create matched triples (each treatment group unit is matched to two
control group units):</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="sc">&gt;</span> tm <span class="ot">&lt;-</span> <span class="fu">pairmatch</span>(pr <span class="sc">~</span> cap, <span class="at">controls =</span> <span class="dv">2</span>, <span class="at">data =</span> nuke.nopt)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="did-matching-work">Did matching work?<a class="anchor" aria-label="anchor" href="#did-matching-work"></a>
</h3>
<p>It’s possible to give the software an impossible list of requirements
for a match. For instance, try running the following:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">pairmatch</span>(pr <span class="sc">~</span> cap, <span class="at">controls =</span> <span class="dv">3</span>, <span class="at">data=</span>nuke.nopt)</span></code></pre></div>
<p>The problem here is that the data don’t have 3 comparison units to go
with each treatment unit, since we have 7 treatment units but only 19
comparison units.</p>
<p>Matching can also fail because the distance matrix embodies matching
constraints that are impossible to meet. In these cases the matching
function will generally run without complaint, although it won’t create
any matches. Here is an example, where the caliper is so narrow as to
forbid all possible matches:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">pairmatch</span>(pr <span class="sc">~</span> cap <span class="sc">+</span> cost, <span class="at">caliper=</span>.<span class="dv">001</span>, <span class="at">data =</span> nuke.nopt)</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="do">## Warning in fullmatch.InfinitySparseMatrix(x = x, min.controls = controls, : Matching failed. (Restrictions impossible to meet?)</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="do">##  Enter ?matchfailed for more info.</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="do">##    H    I    A    J    B    K    L    M    C    N    O    P    Q    R    S    T </span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="do">## &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; </span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="do">##    U    D    V    E    W    F    X    G    Y    Z </span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="do">## &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;</span></span></code></pre></div>
<p>Behind the scenes, the <code>caliper</code> argument restricts how
the maximum distance between matched objects. For example, consider
Table 1 above. Plants A and H are 1.3 units apart in <code>date</code>.
If we assigned <code>caliper=1</code>, they could never be matched
because they exceed the caliper limit.</p>
<p>If before matching you want to remove just the subjects lacking a
counterpart within caliper distance, you can do
<code>pairmatch(..., remove.unmatchables = TRUE)</code>. That won’t help
with the minuscule caliper above, but with less extreme calipers it
helps you salvage a few matches.</p>
</div>
<div class="section level3">
<h3 id="did-matching-balance-the-covariate">Did matching balance the covariate?<a class="anchor" aria-label="anchor" href="#did-matching-balance-the-covariate"></a>
</h3>
<p>Comparing overt biases before and after matching. An assessment of
the unmatched difference between the groups on <code>cap</code> can be
had via:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="sc">&gt;</span> cap.noadj <span class="ot">&lt;-</span> <span class="fu">lm</span>(cap <span class="sc">~</span> pr, <span class="at">data =</span> nuke.nopt)</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(cap.noadj)</span></code></pre></div>
<p>The output is suppressed, as most of it is not relevant to balance.
This variation hones in on the part that is:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(<span class="fu">lm</span>(cap <span class="sc">~</span> pr, <span class="at">data =</span> nuke.nopt))<span class="sc">$</span>coeff[<span class="st">"pr"</span>,]</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="do">##   Estimate Std. Error    t value   Pr(&gt;|t|) </span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="do">## 79.7368421 92.7031668  0.8601307  0.3982280</span></span></code></pre></div>
<p>(Note again the use of square brackets, <code>[</code> and
<code>]</code>, for specifying subsets of a matrix. With <em>R</em> one
has to carefully distinguish square brackets, curly brackets and
parentheses.)</p>
<p>Here is a parallel calculation that takes the match <code>pm</code>
into account.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(<span class="fu">lm</span>(cap <span class="sc">~</span> pr <span class="sc">+</span> pm, <span class="at">data =</span> nuke.nopt))<span class="sc">$</span>coeff[<span class="st">"pr"</span>,]</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="do">##   Estimate Std. Error    t value   Pr(&gt;|t|) </span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="do">## -6.5714286  4.2865079 -1.5330495  0.1761543</span></span></code></pre></div>
<p>The <strong><a href="https://cran.r-project.org/package=RItools" class="external-link">RItools</a></strong>
package’s <code><a href="https://rdrr.io/pkg/RItools/man/balanceTest.html" class="external-link">RItools::balanceTest()</a></code> function zeroes in on
balance, and facilitates checking balance on multiple variables at the
same time. Here are some examples:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">install.packages</span>(<span class="st">"RItools"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(RItools)</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">balanceTest</span>(pr <span class="sc">~</span> cap <span class="sc">+</span> t2, <span class="at">data =</span> nuke.nopt)</span></code></pre></div>
<pre><code><span><span class="co">##      strata():        --                                        </span></span>
<span><span class="co">##      stat      Treatment Control adj.diff std.diff    z         </span></span>
<span><span class="co">## vars                                                            </span></span>
<span><span class="co">## cap                883     803       79.7    0.39    0.86       </span></span>
<span><span class="co">## t2                 66.9    59.5      7.33    0.68    1.61       </span></span>
<span><span class="co">## ---Overall Test---</span></span>
<span><span class="co">##    chisquare df p.value</span></span>
<span><span class="co">## --      2.71  2   0.258</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '** ' 0.01 '*  ' 0.05 '.  ' 0.1 '   ' 1</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">balanceTest</span>(pr <span class="sc">~</span> cap <span class="sc">+</span> t2 <span class="sc">+</span> <span class="fu">strata</span>(pm) <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> nuke.nopt)</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># The `- 1` suppresses the unmatched output to make the output cleaner</span></span></code></pre></div>
<pre><code><span><span class="co">##      strata():        pm                                         </span></span>
<span><span class="co">##      stat      Treatment Control adj.diff std.diff    z          </span></span>
<span><span class="co">## vars                                                             </span></span>
<span><span class="co">## cap               883     890       -6.57   -0.03   -1.40        </span></span>
<span><span class="co">## t2                66.9    61.3      5.57     0.54    1.49        </span></span>
<span><span class="co">## ---Overall Test---</span></span>
<span><span class="co">##    chisquare df p.value</span></span>
<span><span class="co">## pm      6.73  2  0.0345</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '** ' 0.01 '*  ' 0.05 '.  ' 0.1 '   ' 1</span></span></code></pre>
<p><strong>Exercises.</strong></p>
<ol style="list-style-type: decimal">
<li>Compare <code>pm</code>, <code>tm</code> and the unmatched samples
in terms of balance on <code>t2</code>.</li>
<li>Compare <code>pm</code>, <code>tm</code> and the unmatched samples
in terms of balance on <code>date</code>.</li>
<li>Compare <code>pm</code> to Mahalanobis pair matching on
<code>t1</code> in terms of balance on <code>date</code>.</li>
<li>Compare Mahalanobis pair matching on <code>cap</code> and
<code>date</code> to Mahalanobis pair matching on <code>cap</code>,
<code>date</code> and each of <code>t1,t2</code>. Add the last two
variables in one at a time, so that you’re comparing a total of three
matches. Compare on balance in <code>cap</code> and
<code>t2</code>.</li>
</ol>
<p>Section “Checking balance in general”, below, presents convenient
ways to do balance assessment for many variables at once. Before getting
to that let’s discuss try matching with propensity scores.</p>
</div>
</div>
<div class="section level2">
<h2 id="propensity-score-matching">Propensity Score Matching<a class="anchor" aria-label="anchor" href="#propensity-score-matching"></a>
</h2>
<div class="section level3">
<h3 id="propensity-score-fitting-in-r">Propensity score fitting in <em>R</em><a class="anchor" aria-label="anchor" href="#propensity-score-fitting-in-r"></a>
</h3>
<p>Logistic regression models are fit in <em>R</em> using the function
<code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code>, with <code>family</code> argument set to
<code>binomial</code>. Example:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="sc">&gt;</span> psm <span class="ot">&lt;-</span> <span class="fu">glm</span>(pr <span class="sc">~</span> date <span class="sc">+</span> t1 <span class="sc">+</span> t2 <span class="sc">+</span> cap <span class="sc">+</span> ne <span class="sc">+</span> ct <span class="sc">+</span> bw <span class="sc">+</span> cum.n <span class="sc">+</span> pt,</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="sc">+</span>            <span class="at">family =</span> binomial, <span class="at">data =</span> nuclearplants)</span></code></pre></div>
<p>The fitted logistic regression is then stored in the object
<code>psm</code>. The propensity scores can be accessed with
<code>psm$fitted.values</code> (estimated probabilities) or
<code>scores(psm)</code> (estimated logits of probabilities).</p>
<p>It’s often a good idea to compare the groups’ distributions on the
propensity score.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">boxplot</span>(psm)</span></code></pre></div>
<p><img src="fullmatch-vignette_files/figure-html/unnamed-chunk-33-1.png" alt="Box plot showing distribution of propensity scores" width="480"></p>
<p>The groups do overlap, if not greatly. It may be wise to restrict the
sample to the region of overlap, at least roughly. A propensity caliper
would help with this.</p>
<p>First, let’s match directly on the propensity score without
restricting the sample to the region of overlap.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="sc">&gt;</span> ps.pm <span class="ot">&lt;-</span> <span class="fu">pairmatch</span>(psm, <span class="at">data =</span> nuclearplants)</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(ps.pm)</span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a><span class="do">## Structure of matched sets:</span></span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a><span class="do">## 1:1 0:1 </span></span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a><span class="do">##  10  12 </span></span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a><span class="do">## Effective Sample Size:  10 </span></span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a><span class="do">## (equivalent number of matched pairs).</span></span></code></pre></div>
<p>To restrict to the overlapping region, we want to imply a caliper to
the distances generated by the propensity score model. To do this
requires a more explicit generation of the match, involving separate
steps for generation of the distances followed by matching upon those
distances.</p>
<p>First, we create a distance matrix based upon <code>psm</code>:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="sc">&gt;</span> psm.dist <span class="ot">&lt;-</span> <span class="fu">match_on</span>(psm, <span class="at">data=</span>nuclearplants)</span></code></pre></div>
<p><code>psm.dist</code> is a matrix with an entry corresponding to the
distance between each potential pair of treatment and control units. We
can caliper directly on this distance matrix,</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">caliper</span>(psm.dist, <span class="dv">2</span>)</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a><span class="do">##        control</span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a><span class="do">## treated   H   I   J   K   L   M   N   O   P   Q   R   S   T U   V   W   X   Y</span></span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a><span class="do">##       A Inf Inf Inf Inf Inf Inf Inf Inf Inf Inf Inf Inf Inf 0   0 Inf Inf Inf</span></span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a><span class="do">##       B Inf   0 Inf Inf Inf   0   0   0 Inf   0   0   0   0 0   0   0 Inf Inf</span></span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a><span class="do">##       C Inf   0   0 Inf Inf   0   0   0 Inf   0   0   0   0 0 Inf   0   0 Inf</span></span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a><span class="do">##       D Inf Inf Inf Inf Inf Inf Inf Inf Inf Inf Inf   0 Inf 0   0 Inf Inf Inf</span></span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a><span class="do">##       E Inf   0 Inf Inf Inf   0   0   0 Inf   0   0   0   0 0   0   0   0 Inf</span></span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a><span class="do">##       F Inf   0 Inf Inf Inf   0 Inf   0 Inf Inf   0   0   0 0   0 Inf Inf Inf</span></span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a><span class="do">##       G Inf   0 Inf Inf Inf   0   0   0 Inf   0   0   0   0 0   0   0 Inf Inf</span></span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a><span class="do">##       a Inf   0 Inf Inf Inf Inf Inf Inf Inf Inf   0   0   0 0   0 Inf Inf Inf</span></span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a><span class="do">##       b Inf Inf Inf Inf Inf Inf Inf Inf Inf Inf Inf Inf Inf 0   0 Inf Inf Inf</span></span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a><span class="do">##       c Inf   0 Inf Inf Inf   0   0   0 Inf   0   0   0   0 0   0   0 Inf Inf</span></span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a><span class="do">##        control</span></span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a><span class="do">## treated   Z d   e   f</span></span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a><span class="do">##       A Inf 0 Inf Inf</span></span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a><span class="do">##       B   0 0 Inf   0</span></span>
<span id="cb31-18"><a href="#cb31-18" tabindex="-1"></a><span class="do">##       C   0 0 Inf   0</span></span>
<span id="cb31-19"><a href="#cb31-19" tabindex="-1"></a><span class="do">##       D Inf 0 Inf Inf</span></span>
<span id="cb31-20"><a href="#cb31-20" tabindex="-1"></a><span class="do">##       E   0 0 Inf   0</span></span>
<span id="cb31-21"><a href="#cb31-21" tabindex="-1"></a><span class="do">##       F   0 0 Inf   0</span></span>
<span id="cb31-22"><a href="#cb31-22" tabindex="-1"></a><span class="do">##       G   0 0 Inf   0</span></span>
<span id="cb31-23"><a href="#cb31-23" tabindex="-1"></a><span class="do">##       a   0 0 Inf   0</span></span>
<span id="cb31-24"><a href="#cb31-24" tabindex="-1"></a><span class="do">##       b Inf 0 Inf Inf</span></span>
<span id="cb31-25"><a href="#cb31-25" tabindex="-1"></a><span class="do">##       c   0 0 Inf   0</span></span></code></pre></div>
<p>Entries which are <code>Inf</code> will never be matched. Adding the
caliper to <code>psm.dist</code> will disallow matching between units
which differ by more than 2 standard deviations.</p>
<p>(Note that this differs from the previous use of <code>caliper</code>
directly in <code>pairmatch</code>, where the caliper is applied
directly to the distances instead of smartly upon the standard
deviations between the propensity scores.)</p>
<p>Combining the above, we can now</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="sc">&gt;</span> ps.pm2 <span class="ot">&lt;-</span> <span class="fu">pairmatch</span>(psm.dist, <span class="at">data =</span> nuclearplants)</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a><span class="sc">&gt;</span> ps.pm3 <span class="ot">&lt;-</span> <span class="fu">pairmatch</span>(psm.dist <span class="sc">+</span> <span class="fu">caliper</span>(psm.dist, <span class="dv">2</span>), <span class="at">data =</span> nuclearplants)</span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">all.equal</span>(ps.pm, ps.pm2, <span class="at">check.attributes=</span><span class="cn">FALSE</span>)</span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a><span class="do">## [1] TRUE</span></span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">all.equal</span>(ps.pm, ps.pm3, <span class="at">check.attributes=</span><span class="cn">FALSE</span>)</span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a><span class="do">## [1] "7 string mismatches"</span></span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(ps.pm3)</span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a><span class="do">## Structure of matched sets:</span></span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a><span class="do">## 1:1 0:1 </span></span>
<span id="cb32-10"><a href="#cb32-10" tabindex="-1"></a><span class="do">##  10  12 </span></span>
<span id="cb32-11"><a href="#cb32-11" tabindex="-1"></a><span class="do">## Effective Sample Size:  10 </span></span>
<span id="cb32-12"><a href="#cb32-12" tabindex="-1"></a><span class="do">## (equivalent number of matched pairs).</span></span></code></pre></div>
<p>Or you could match within calipers of the propensity score on some
other distance, perhaps Mahalanobis distances based on selected
covariates as recommended by Rubin and Thomas (2000, JASA) and others.
For Mahalanobis matching on <code>date</code>, <code>cap</code> and the
propensity score, for instance, combined with a propensity caliper of 1
pooled sd.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="sc">&gt;</span> mhd1 <span class="ot">&lt;-</span> <span class="fu">match_on</span>(pr <span class="sc">~</span> date <span class="sc">+</span> cap <span class="sc">+</span> <span class="fu">scores</span>(psm), <span class="at">data=</span>nuclearplants)</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a><span class="sc">&gt;</span> mhpc.pm <span class="ot">&lt;-</span> <span class="fu">pairmatch</span>(mhd1, <span class="at">caliper=</span><span class="dv">1</span>, <span class="at">data=</span>nuclearplants)</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(mhpc.pm) <span class="co"># oops</span></span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a><span class="do">## Structure of matched sets:</span></span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a><span class="do">## 1:1 0:1 </span></span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a><span class="do">##  10  12 </span></span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a><span class="do">## Effective Sample Size:  10 </span></span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a><span class="do">## (equivalent number of matched pairs).</span></span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a><span class="sc">&gt;</span> mhpc.pm <span class="ot">&lt;-</span> <span class="fu">pairmatch</span>(mhd1, <span class="at">caliper=</span><span class="dv">2</span>, <span class="at">data=</span>nuclearplants)</span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(mhpc.pm) <span class="co"># better!</span></span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a><span class="do">## Structure of matched sets:</span></span>
<span id="cb33-12"><a href="#cb33-12" tabindex="-1"></a><span class="do">## 1:1 0:1 </span></span>
<span id="cb33-13"><a href="#cb33-13" tabindex="-1"></a><span class="do">##  10  12 </span></span>
<span id="cb33-14"><a href="#cb33-14" tabindex="-1"></a><span class="do">## Effective Sample Size:  10 </span></span>
<span id="cb33-15"><a href="#cb33-15" tabindex="-1"></a><span class="do">## (equivalent number of matched pairs).</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="checking-balance-in-general">Checking balance in general<a class="anchor" aria-label="anchor" href="#checking-balance-in-general"></a>
</h3>
<p>The <strong><a href="https://cran.r-project.org/package=RItools" class="external-link">RItools</a></strong>
package has a convenient function for checking balance on many variables
simultaneously. To get a sense of what it does, try this:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">balanceTest</span>(pr <span class="sc">~</span> date <span class="sc">+</span> t1 <span class="sc">+</span> t2 <span class="sc">+</span> cap <span class="sc">+</span> ne <span class="sc">+</span> ct <span class="sc">+</span> bw <span class="sc">+</span> cum.n,</span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a><span class="sc">+</span>             <span class="at">data =</span> nuclearplants)</span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">balanceTest</span>(pr <span class="sc">~</span> date <span class="sc">+</span> t1 <span class="sc">+</span> t2 <span class="sc">+</span> cap <span class="sc">+</span> ne <span class="sc">+</span> ct <span class="sc">+</span> bw <span class="sc">+</span> cum.n <span class="sc">+</span> pt <span class="sc">+</span></span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a><span class="sc">+</span>               <span class="fu">strata</span>(ps.pm2) <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a><span class="sc">+</span>             <span class="at">data =</span> nuclearplants)</span></code></pre></div>
<p>It can in the same display compare matching to no matching, on any of
a number of axes. Here is a demonstration:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="sc">&gt;</span> myb <span class="ot">&lt;-</span> <span class="fu">balanceTest</span>(pr <span class="sc">~</span> date <span class="sc">+</span> t1 <span class="sc">+</span> t2 <span class="sc">+</span> cap <span class="sc">+</span> ne <span class="sc">+</span> ct <span class="sc">+</span> bw <span class="sc">+</span> cum.n <span class="sc">+</span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a><span class="sc">+</span>                      <span class="fu">strata</span>(ps.pm2),</span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a><span class="sc">+</span>                    <span class="at">data =</span> nuclearplants)</span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">plot</span>(myb)</span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">print</span>(myb, <span class="at">digits=</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code><span><span class="co">##       strata():    ps.pm2                                                --                                        </span></span>
<span><span class="co">##       stat      Treatment Control adj.diff std.diff    z          Treatment Control adj.diff std.diff    z         </span></span>
<span><span class="co">## vars                                                                                                               </span></span>
<span><span class="co">## date                68      69       -0.2     0        0              68      69       -0.1     0        0         </span></span>
<span><span class="co">## t1                  14      14       -0.3     0        0              14      14        0.4     0        0         </span></span>
<span><span class="co">## t2                  69      63        6       1        2              69      59       10       1        2         </span></span>
<span><span class="co">## cap                 870     890      -20      0        0              870     805       65      0        1         </span></span>
<span><span class="co">## ne                  0.2     0.1       0.10    0        1              0.2     0.3      -0.07    0        0         </span></span>
<span><span class="co">## ct                  0.3     0.2       0.1     0        0              0.3     0.5      -0.2     0       -1         </span></span>
<span><span class="co">## bw                  0.2     0.2      0.00     0       NA              0.2     0.2      0.02     0        0         </span></span>
<span><span class="co">## cum.n               8       9        -0.5     0        0              8       9        -0.6     0        0         </span></span>
<span><span class="co">## ---Overall Test---</span></span>
<span><span class="co">##        chisquare df p.value</span></span>
<span><span class="co">## ps.pm2         7  7     0.4</span></span>
<span><span class="co">## --            11  8     0.2</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '** ' 0.01 '*  ' 0.05 '.  ' 0.1 '   ' 1</span></span></code></pre>
<p><img src="fullmatch-vignette_files/figure-html/unnamed-chunk-41-1.png" alt="Love plot showing the change in balance with and without matching" width="480"></p>
<p>For a very compact representation of the assessment, call
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> on the match, passing along the fitted propensity
model as a second argument. If you’ve got <strong><a href="https://cran.r-project.org/package=RItools" class="external-link">RItools</a></strong>
loaded, then this will call <code><a href="https://rdrr.io/pkg/RItools/man/balanceTest.html" class="external-link">balanceTest()</a></code> in the
background, reporting the summary chi-square test results.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(ps.pm2, psm)</span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a><span class="do">## Structure of matched sets:</span></span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a><span class="do">## 1:1 0:1 </span></span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a><span class="do">##  10  12 </span></span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a><span class="do">## Effective Sample Size:  10 </span></span>
<span id="cb37-6"><a href="#cb37-6" tabindex="-1"></a><span class="do">## (equivalent number of matched pairs).</span></span>
<span id="cb37-7"><a href="#cb37-7" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb37-8"><a href="#cb37-8" tabindex="-1"></a><span class="do">## Balance test overall result:</span></span>
<span id="cb37-9"><a href="#cb37-9" tabindex="-1"></a><span class="do">##   chisquare df p.value</span></span>
<span id="cb37-10"><a href="#cb37-10" tabindex="-1"></a><span class="do">##        7.31  8   0.503</span></span></code></pre></div>
<p><strong>Exercise.</strong></p>
<p>Try out {at least 3} different combinations of propensity score and
Mahalanobis matching. Identify the matches that gives:</p>
<ol style="list-style-type: decimal">
<li>the “best balance overall,” as measured by Chi-square
statistics;</li>
<li>the “best balance overall,” as indicated by the largest standardized
difference among the covariates;</li>
<li>the best balance on <code>date</code> and <code>cap</code>, as
measured by the larger of the standardized differences for these two
variables; and</li>
<li>the best balance on <code>date</code> and <code>cap</code>, as
measured by the larger of the standardized differences for these two
variables, among those matches for which the overall imbalance
<em>p</em>-value is no more than .1.</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="other-topics-in-matching">Other topics in matching<a class="anchor" aria-label="anchor" href="#other-topics-in-matching"></a>
</h2>
<div class="section level3">
<h3 id="full-matching-and-matching-with-a-varying-number-of-controls">Full matching and matching with a varying number of controls<a class="anchor" aria-label="anchor" href="#full-matching-and-matching-with-a-varying-number-of-controls"></a>
</h3>
<p>Try out for yourself and compare:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(<span class="fu">fullmatch</span>(pr <span class="sc">~</span> date <span class="sc">+</span> cap, <span class="at">data =</span> nuke.nopt))</span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(<span class="fu">fullmatch</span>(pr <span class="sc">~</span> date <span class="sc">+</span> cap, <span class="at">data =</span> nuke.nopt, <span class="at">min =</span> <span class="dv">1</span>))</span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(<span class="fu">fullmatch</span>(pr <span class="sc">~</span> date <span class="sc">+</span> cap, <span class="at">data =</span> nuke.nopt, <span class="at">min =</span> <span class="dv">2</span>, <span class="at">max =</span> <span class="dv">3</span>))</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="subclassification-before-matching">Subclassification before matching<a class="anchor" aria-label="anchor" href="#subclassification-before-matching"></a>
</h3>
<p>Recall that the data set <code>nuclearplants</code> had 32
observations, 6 of which we excluded. These were plants built under
“partial turnkey” guarantees (<code>pt == 1</code>), for which costs are
difficult to compare with other plants. We might include the excluded
plants by matching them only among themselves. Then we need to
subclassify prior to matching.</p>
<p>This is a common and useful operation, and <strong>optmatch</strong>
is designed to help you do it via a <code>strata</code> term in the
matching formula.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">pairmatch</span>(pr <span class="sc">~</span> date <span class="sc">+</span> cap <span class="sc">+</span> <span class="fu">scores</span>(psm), <span class="at">data=</span>nuclearplants)</span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a><span class="do">##    H    I    A    J    B    K    L    M    C    N    O    P    Q    R    S    T </span></span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a><span class="do">## &lt;NA&gt;  1.1  1.1 &lt;NA&gt;  1.2 &lt;NA&gt; &lt;NA&gt;  1.4  1.3  1.3 &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;  1.2 &lt;NA&gt;  1.8 </span></span>
<span id="cb39-4"><a href="#cb39-4" tabindex="-1"></a><span class="do">##    U    D    V    E    W    F    X    G    Y    Z    d    e    f    a    b    c </span></span>
<span id="cb39-5"><a href="#cb39-5" tabindex="-1"></a><span class="do">##  1.7  1.4  1.5  1.5 &lt;NA&gt;  1.6  1.6  1.7 &lt;NA&gt; &lt;NA&gt;  1.9 &lt;NA&gt; 1.10  1.8  1.9 1.10</span></span>
<span id="cb39-6"><a href="#cb39-6" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">pairmatch</span>(pr <span class="sc">~</span> date <span class="sc">+</span> cap <span class="sc">+</span> <span class="fu">scores</span>(psm) <span class="sc">+</span> <span class="fu">strata</span>(pt), <span class="at">data=</span>nuclearplants)</span>
<span id="cb39-7"><a href="#cb39-7" tabindex="-1"></a><span class="do">##    H    I    A    J    B    K    L    M    C    N    O    P    Q    R    S    T </span></span>
<span id="cb39-8"><a href="#cb39-8" tabindex="-1"></a><span class="do">## &lt;NA&gt;  0.1  0.1 &lt;NA&gt;  0.2 &lt;NA&gt; &lt;NA&gt;  0.4  0.3  0.3 &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;  0.2 &lt;NA&gt; &lt;NA&gt; </span></span>
<span id="cb39-9"><a href="#cb39-9" tabindex="-1"></a><span class="do">##    U    D    V    E    W    F    X    G    Y    Z    d    e    f    a    b    c </span></span>
<span id="cb39-10"><a href="#cb39-10" tabindex="-1"></a><span class="do">##  0.7  0.4  0.5  0.5 &lt;NA&gt;  0.6  0.6  0.7 &lt;NA&gt; &lt;NA&gt;  1.2  1.1  1.3  1.1  1.2  1.3</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="distances">Distances<a class="anchor" aria-label="anchor" href="#distances"></a>
</h3>
<p>You’ll often want to do several variations on a match. It may save
computation and typing time to store the distance you’re using to match,
if you’re going to re-use that distance. To do so, you’ll have to
explicitly separate distance-making and matching, two steps that we’ve
merged together thus far. We’ll use the <code><a href="../reference/match_on-methods.html">match_on()</a></code> to
create distances.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="sc">&gt;</span> cap.dist <span class="ot">&lt;-</span> <span class="fu">match_on</span>(pr <span class="sc">~</span> cap, <span class="at">data =</span> nuke.nopt)</span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a><span class="sc">&gt;</span> pm1 <span class="ot">&lt;-</span> <span class="fu">pairmatch</span>(pr <span class="sc">~</span> cap, <span class="at">data=</span>nuke.nopt)</span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a><span class="sc">&gt;</span> pm2 <span class="ot">&lt;-</span> <span class="fu">pairmatch</span>(cap.dist, <span class="at">data=</span>nuke.nopt)</span>
<span id="cb40-4"><a href="#cb40-4" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">all.equal</span>(pm1, pm2, <span class="at">check.attributes =</span> <span class="cn">FALSE</span>)</span>
<span id="cb40-5"><a href="#cb40-5" tabindex="-1"></a><span class="do">## [1] TRUE</span></span>
<span id="cb40-6"><a href="#cb40-6" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(pm2)</span>
<span id="cb40-7"><a href="#cb40-7" tabindex="-1"></a><span class="do">## Structure of matched sets:</span></span>
<span id="cb40-8"><a href="#cb40-8" tabindex="-1"></a><span class="do">## 1:1 0:1 </span></span>
<span id="cb40-9"><a href="#cb40-9" tabindex="-1"></a><span class="do">##   7  12 </span></span>
<span id="cb40-10"><a href="#cb40-10" tabindex="-1"></a><span class="do">## Effective Sample Size:  7 </span></span>
<span id="cb40-11"><a href="#cb40-11" tabindex="-1"></a><span class="do">## (equivalent number of matched pairs).</span></span></code></pre></div>
<p>What does a matching distance look like? Here’s the upper-left corner
of one of them:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">round</span>(cap.dist[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="dv">1</span>)</span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a><span class="do">##          control</span></span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a><span class="do">## treatment   H   I   J</span></span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a><span class="do">##         A 1.8 0.0 0.0</span></span>
<span id="cb41-5"><a href="#cb41-5" tabindex="-1"></a><span class="do">##         B 1.8 0.0 0.0</span></span>
<span id="cb41-6"><a href="#cb41-6" tabindex="-1"></a><span class="do">##         C 0.6 1.2 1.2</span></span></code></pre></div>
<p>(Note the use of square brackets, <code>[</code> and <code>]</code>,
for specifying rows and columns of the distance matrix. If you find that
this isn’t working on a distance that you’ve produced, try
<code>as.matrix(my.dist)[1:3,1:3]</code> or similar.)</p>
<p>Matching with a caliper of 2 pooled standard deviations on the
<code>cap</code> variable:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">round</span>(cap.dist <span class="sc">+</span> <span class="fu">caliper</span>(cap.dist, <span class="dv">2</span>), <span class="dv">1</span>)</span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a><span class="do">##        control</span></span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a><span class="do">## treated   H   I   J   K   L   M   N   O   P   Q   R   S   T   U   V   W   X   Y</span></span>
<span id="cb42-4"><a href="#cb42-4" tabindex="-1"></a><span class="do">##       A 1.8 0.0 0.0 Inf 1.2 Inf 1.3 Inf 1.3 Inf 0.1 1.0 1.4 1.0 0.1 0.7 1.3 Inf</span></span>
<span id="cb42-5"><a href="#cb42-5" tabindex="-1"></a><span class="do">##       B 1.8 0.0 0.0 Inf 1.2 Inf 1.3 Inf 1.3 Inf 0.1 1.0 1.4 1.0 0.1 0.7 1.3 Inf</span></span>
<span id="cb42-6"><a href="#cb42-6" tabindex="-1"></a><span class="do">##       C 0.6 1.2 1.2 1.5 0.0 1.7 0.1 1.2 0.2 1.4 1.1 0.1 0.2 0.1 1.3 0.4 0.2 1.4</span></span>
<span id="cb42-7"><a href="#cb42-7" tabindex="-1"></a><span class="do">##       D 0.7 Inf Inf 0.1 1.4 0.3 1.2 0.1 1.2 0.0 Inf 1.5 1.2 1.5 Inf 1.8 1.2 0.0</span></span>
<span id="cb42-8"><a href="#cb42-8" tabindex="-1"></a><span class="do">##       E 1.7 0.1 0.1 Inf 1.1 Inf 1.2 Inf 1.2 Inf 0.0 1.0 1.3 1.0 0.2 0.7 1.3 Inf</span></span>
<span id="cb42-9"><a href="#cb42-9" tabindex="-1"></a><span class="do">##       F 0.7 1.1 1.1 1.5 0.0 1.8 0.2 1.3 0.2 1.4 1.1 0.1 0.2 0.1 1.2 0.4 0.2 1.4</span></span>
<span id="cb42-10"><a href="#cb42-10" tabindex="-1"></a><span class="do">##       G 0.6 1.2 1.2 1.5 0.0 1.7 0.1 1.2 0.1 1.4 1.1 0.1 0.2 0.1 1.3 0.4 0.2 1.3</span></span>
<span id="cb42-11"><a href="#cb42-11" tabindex="-1"></a><span class="do">##        control</span></span>
<span id="cb42-12"><a href="#cb42-12" tabindex="-1"></a><span class="do">## treated   Z</span></span>
<span id="cb42-13"><a href="#cb42-13" tabindex="-1"></a><span class="do">##       A 0.3</span></span>
<span id="cb42-14"><a href="#cb42-14" tabindex="-1"></a><span class="do">##       B 0.3</span></span>
<span id="cb42-15"><a href="#cb42-15" tabindex="-1"></a><span class="do">##       C 1.5</span></span>
<span id="cb42-16"><a href="#cb42-16" tabindex="-1"></a><span class="do">##       D Inf</span></span>
<span id="cb42-17"><a href="#cb42-17" tabindex="-1"></a><span class="do">##       E 0.4</span></span>
<span id="cb42-18"><a href="#cb42-18" tabindex="-1"></a><span class="do">##       F 1.4</span></span>
<span id="cb42-19"><a href="#cb42-19" tabindex="-1"></a><span class="do">##       G 1.5</span></span></code></pre></div>
<p>Entries of <code>Inf</code> or <code>NaN</code> in a distance matrix
are interpreted as forbidden matches. Thus</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">pairmatch</span>(cap.dist <span class="sc">+</span> <span class="fu">caliper</span>(cap.dist, <span class="dv">2</span>), <span class="at">data =</span> nuke.nopt)</span></code></pre></div>
<p>matches on <code>cap</code>, insisting that paired units not differ
by more than 2 pooled SDs in <code>cap</code>. If you would prefer to
set a requirement on how much paired units can differ in
<code>cap</code> in its original units, rather than standard units, then
you would have to create <code>cap.dist</code> in a somewhat different
way. There’s an example on the help page for <code><a href="../reference/caliper-methods.html">caliper()</a></code>.
Enter <code><a href="../reference/caliper-methods.html">help(caliper)</a></code> at the <em>R</em> command line.</p>
</div>
<div class="section level3">
<h3 id="trying-it-out-on-your-own">Trying it out on your own<a class="anchor" aria-label="anchor" href="#trying-it-out-on-your-own"></a>
</h3>
<p>Below are some suggestions of other data sets you could try this out
on.</p>
<p>For another interesting (toy) data set, you can use the “tli” data
set in the <strong><a href="https://cran.r-project.org/package=xtable" class="external-link">xtable</a></strong>
package.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">install.packages</span>(<span class="st">"xtable"</span>) <span class="co"># if not already installed</span></span>
<span id="cb44-2"><a href="#cb44-2" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">data</span>(tli, <span class="at">package =</span> <span class="st">"xtable"</span>)</span></code></pre></div>
<p>You might compare test scores for kids with
<code>disadvg=="YES"</code> to those of kids with
<code>disadvg=="NO"</code> using propensity matching, in some
combination with Mahalanobis matching and caliper matching. A check of
propensity overlap may inform your decision as to whether to include a
propensity caliper. Be sure to check for balance, and do check the
structure of the matched sets.</p>
<p>Three sources of data can be gotten as follows. First, Paul Rosenbaum
has collected many of the data sets discussed in his <em>Design of
Observational Studies</em> (2010) into the <strong><a href="https://cran.r-project.org/package=DOS" class="external-link">DOS</a></strong> and
<strong><a href="https://cran.r-project.org/package=DOS2" class="external-link">DOS2</a></strong>
packages.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">install.packages</span>(<span class="st">"DOS"</span>) <span class="co"># if not already installed</span></span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">install.packages</span>(<span class="st">"DOS2"</span>) <span class="co"># if not already installed</span></span>
<span id="cb45-3"><a href="#cb45-3" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">data</span>(<span class="at">package =</span> <span class="st">"DOS"</span>)</span>
<span id="cb45-4"><a href="#cb45-4" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">data</span>(<span class="at">package =</span> <span class="st">"DOS2"</span>)</span></code></pre></div>
<p>Second, the “lalonde” data set, discussed by Lalonde (1986, <em>Am.
Econom. Rev.</em>), Dehejia and Wahba (1999, <em>JASA</em>) and Smith
and Todd (2005, <em>J. Econom.</em>), is bundled with several <em>R</em>
packages, including <strong><a href="https://cran.r-project.org/package=arm" class="external-link">arm</a></strong> and
<strong><a href="https://cran.r-project.org/package=Matching" class="external-link">Matching</a></strong>.
To get it:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">install.packages</span>(<span class="st">"arm"</span>) <span class="co"># if not already installed</span></span>
<span id="cb46-2"><a href="#cb46-2" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">data</span>(lalonde, <span class="at">package =</span> <span class="st">"arm"</span>)</span>
<span id="cb46-3"><a href="#cb46-3" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">help</span>(<span class="st">"lalonde"</span>, <span class="at">package =</span> <span class="st">"arm"</span>)</span></code></pre></div>
<p>Third, the data used by Connors et al (1996, <em>J. Am. Med.
Assoc.</em>) to examine costs, benefits and risks associated with right
heart catheterization is bundled with Frank Harrell and collaborators’
<strong><a href="https://cran.r-project.org/package=Hmisc" class="external-link">Hmisc</a></strong>
package.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">install.packages</span>(<span class="st">"Hmisc"</span>) <span class="co"># if not already installed</span></span>
<span id="cb47-2"><a href="#cb47-2" tabindex="-1"></a><span class="sc">&gt;</span> Hmisc<span class="sc">:::</span><span class="fu">getHdata</span>(rhc, <span class="at">what =</span> <span class="st">"all"</span>)</span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ben Hansen, Mark Fredrickson, Josh Errickson, Josh Buckner.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
